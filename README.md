# mini-HIS: 醫院資訊系統示範專案

這是一個使用 TypeScript 開發的醫院資訊系統 (Hospital Information System) 示範專案，旨在展示「先寫類型再寫邏輯」的開發方法，以及如何使用代數資料類型 (Algebraic Data Types, ADT) 來規範和簡化程式碼邏輯。

## 開發理念

### 先寫類型再寫邏輯

在傳統開發中，我們常常先考慮程式的行為和邏輯，然後才定義資料結構。這種方式容易導致類型不一致、邊界情況處理不當等問題。在本專案中，我們將採用相反的方式：

1. **先定義完整的類型系統**：包括實體類型、狀態類型、操作結果類型等。
2. **利用類型來引導邏輯實現**：讓編譯器幫助我們檢查是否處理了所有可能的情況。
3. **使用類型來表達業務規則**：將業務規則編碼到類型系統中，而不是散落在各處的條件判斷。

這種方法有以下優點：

- **提早發現錯誤**：在編譯時就能發現許多潛在的錯誤。
- **自文檔化**：類型定義本身就是一種文檔，清晰地表達了數據的結構和約束。
- **引導實現**：類型定義為實現提供了明確的指導，使得實現更加直觀和可靠。
- **促進模組化**：清晰的類型邊界有助於設計更加模組化的系統。

### 代數資料類型 (ADT) 的應用

代數資料類型是函數式程式設計中的重要概念，在 TypeScript 中主要通過聯合類型 (Union Types) 和介面 (Interfaces) 來實現。我們將特別關注：

1. **狀態建模**：使用標籤聯合類型 (Tagged Union Types) 來表示不同狀態。
2. **結果處理**：使用 Result 類型來處理可能的成功或失敗情況。
3. **類型守衛**：使用類型守衛 (Type Guards) 來安全地處理不同類型的值。

例如，我們使用 ADT 來表示病患的不同狀態：

```typescript
// 病患可能處於的不同狀態
export type PatientState = 
  | Registered   // 已掛號
  | Admitted     // 已入院
  | Discharged   // 已出院
  | Transferred; // 已轉院
```

通過這種方式，我們可以確保病患只能處於這些預定義的狀態之一，並且每種狀態都有其特定的屬性和行為。

## 核心概念

### 類型優先開發方法

「先寫類型再寫邏輯」是一種開發方法，它強調在實現具體邏輯之前，先定義清晰的類型結構。這種方法有以下優點：

1. **提早發現錯誤**：在編譯時就能發現許多潛在的錯誤，而不是在運行時才發現
2. **自文檔化**：類型定義本身就是一種文檔，它清晰地表達了數據的結構和約束
3. **引導實現**：類型定義為實現提供了明確的指導，使得實現更加直觀和可靠
4. **促進模組化**：清晰的類型邊界有助於設計更加模組化的系統

### 代數資料類型 (ADT)

代數資料類型是一種用於表示複雜數據結構的方式，它允許我們通過組合簡單類型來創建更複雜的類型。在這個專案中，我們主要使用了 TypeScript 的聯合類型 (Union Types) 和介面 (Interfaces) 來實現 ADT。

例如，我們使用 ADT 來表示病患的不同狀態：

```typescript
// 病患可能處於的不同狀態
export type PatientState = 
  | Registered   // 已掛號
  | Admitted     // 已入院
  | Discharged   // 已出院
  | Transferred; // 已轉院
```

通過這種方式，我們可以確保病患只能處於這些預定義的狀態之一，並且每種狀態都有其特定的屬性和行為。

## 專案結構

```txt
mini-HIS/
├── README.md         # 專案說明文件
├── src/
│   ├── types/        # 類型定義
│   │   ├── common.ts # 通用類型
│   │   └── results.ts # 結果類型 (ADT)
│   ├── models/       # 模型定義
│   │   ├── Patient.ts       # 病患管理模組
│   │   ├── Appointment.ts   # 預約系統模組
│   │   ├── Prescription.ts  # 藥物處方模組
│   │   └── MedicalService.ts # 醫療服務模組
│   └── index.ts      # 主入口文件
└── examples/         # 示例代碼
    ├── patient-workflow.ts      # 病患工作流示例
    └── prescription-workflow.ts # 處方工作流示例
```

## 如何運行

**環境要求：** 請確保你的 Node.js 版本為 22 或更高版本。

這個專案不需要任何安裝或編譯步驟，就可以直接執行。

### 運行主程式

```bash
node src/index.ts
```

### 運行示例

```bash
node examples/patient-workflow.ts
node examples/prescription-workflow.ts
```

## 核心模組說明

### 1. 病患管理 (Patient.ts)

這個模組展示了如何使用 ADT 來表示病患的不同狀態（已掛號、已入院、已出院、已轉院），以及如何通過類型來引導病患狀態轉換的邏輯實現。

### 2. 預約系統 (Appointment.ts)

這個模組展示了如何使用 ADT 來表示預約的不同狀態（已創建、已確認、已完成、已取消、已重排），以及如何通過類型來引導預約流程的邏輯實現。

### 3. 藥物處方 (Prescription.ts)

這個模組展示了如何使用 ADT 來表示處方的不同狀態（已開立、已送出、調劑中、已調劑、已發放、已取消、已拒絕），以及如何通過類型來引導處方流程的邏輯實現。

### 4. 醫療服務 (MedicalService.ts)

這個模組展示了如何使用 ADT 來表示醫療服務的不同狀態（已請求、已排程、準備中、進行中、已完成、已取消、已延期），以及如何通過類型來引導服務流程的邏輯實現。

## 示例說明

### 1. 病患工作流 (patient-workflow.ts)

這個示例展示了如何使用 ADT 來處理病患從掛號到出院的完整流程。通過這個例子，我們可以看到「先寫類型再寫邏輯」的開發方法如何幫助我們確保系統的狀態轉換是類型安全的。

### 2. 處方工作流 (prescription-workflow.ts)

這個示例展示了如何使用 ADT 來處理處方從開立到發放的完整流程。通過這個例子，我們可以看到 ADT 如何幫助我們避免不合法的狀態轉換，以及如何通過類型來引導程式邏輯的實現。

## 結論

通過這個專案，我們展示了「先寫類型再寫邏輯」的開發方法和 ADT 的應用如何幫助我們設計和實現更加可靠、可維護的系統。這種方法特別適合於具有複雜狀態轉換的系統，如醫院信息系統。

通過先定義清晰的類型結構，我們可以在編譯時就發現許多潛在的錯誤，並且使得程式碼更加自文檔化和易於理解。這種方法也促進了模組化設計，使得系統更加靈活和可擴展。
